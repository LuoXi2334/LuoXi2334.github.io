---
title: 作用域和链接属性
date: 2023-1-9 16:00:00
description: 洛希的一月份笔记内容
categories: c语言
tag: C语言 
---


# 作用域和链接属性

## ①作用域的定义

当变量被定义在程序都是不同位置时， 它的作用范围是不一样的，这个作用范围就是我们所说的作用域。`C语言编译器可以确定4种不同类型的作用域:代码块作用域，文件作用域，原型作用域，函数作用域`

### （1）代码块作用域(block scope)

在代码块中定义变量，具有代码块作用域。`作用范围是从变量定义的位置开始，对标志该代码块结束的有大括号“}”处。`

尽管`函数的形式参数不在大括号内定义，但其同样具有代码块作用域`，隶属于包含函数体的代码块。以下来用一串代码举个例子。

```c
#include <stdio.h>
int main()
{
    int i = 114; // i1
    {
        int i = 1145; // i2
        {
            printf("in i2 block scope i = %d\n", i);
            int i = 11451; // i3
            printf("i3 = %d\n", i);
        } // i3代码块内
        {
            int i = 114514; // i4
            printf("i4 = %d\n", i);
        } // i4代码块内
        printf("i2 = %d\n", i);
    } // i2代码块内
    printf("i1 = %d\n", i);
    return 0;
}
```

比如以上的代码虽然重复定义了i，但是作用域各不相同,所以不会进行报错，在不同作用域会会打印出出不同i的值，不过在i3的代码块中如果先打印后将i赋值为11451此时在i2代码块内所以对应的i值是1145。

![image-20230110142704337](https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202301101427452.png)

### （2）文件作用域(file scope)

`任何在代码块之外声明的标识符都具有文件作用域`，`作用范围是从它们声明的位置开始，到文件的结尾`处都是可以访问的。

另外，函数名也具有文件作用域，因为函数名本来是在代码块之外。以下将用一串代码做个例子。

```c
#include <stdio.h>
void func(); // 声明func，告诉编译器调用函数时别急着报，看看下面再说
int main()
{
    extern int count; // 告诉编译器别急着报错，看看下面再说
    func();
    count++;
    printf("in main count = %d\n", count);
    return 0;
}
int count = 0; // 定义全局变量count，文件作用域从10-14
void func()    // 定义函数，文件作用域从11-14
{
    count++;
    printf("in func count = %d\n", count);
}
```

对于以上的代码，下面定义的全局变量以及函数本来文件作用域是对应定义地方向下的，但是因为前面进行了声明，所以编译器没有报错，但是文件作用域没变。

![image-20230110144151379](https://luoxi2334.oss-cn-shanghai.aliyuncs.com/luoxi-picture/202301101441452.png)

### （3）原型作用域(prototype scope)

原型作用域`只适用于那些在函数原型中声明的参数名`。函数在`声明的时候可以不写参数的名字（但参数类型是必须写上的）`，其实函数原型的参数名还可以随便写一个名字，不必与形式参数相匹配（当然，这样做无任何意义！）

```c
void func(int a,int b,int c);//作用域为一个括号
void func(int d,int e,int f)
{
......
}
```

### （4）函数作用域(function scope)

函数作用域只适用于goto语句的标签，作用将goto语句的标签限制在一个函数内部，以及防止出现重名标签。

注：一般不推荐用goto语句跳来跳去，这样会`破坏代码的整体性`。

## ②定义和声明

当一个变量被`定义`的时候，`编译器为变量申请内存空间并填充一些值`。

当一个变量被`声明`的时候，`编译器就知道变量被定义在其他地方`。

声明是`通知编译器该变量名及相关的类型已存在`，不需要再为此申请内存空间。

`局部变量即是定义又是声明`。

`定义只允许一次`，否则就叫做重复定义某个同名变量；而`声明可以有很多次`。

## ③链接属性

### （1）分类

**1.external（外部的）**

多个文件中声明的同名标识符表示同一个实体

**2.internal（内部的）**

单个文件中声明的同名标识符表示同一个实体

**3.none(无)**

声明的同名标识符被当作独立不同的实体。

**注：只有具备文件作用域的标识符才能拥有external或internal的链接属性，其他作用域的标识符都是none属性。默认情况下，具备文件作用域的标识符拥有external属性。也就是说该标识符允许跨文件访问。对于external属性的标识符，无论在不同文件中声明多少次，都表示一个实体。**

### （2）static

使用static关键字可以使得原先拥有external属性的标识符变为internal属性。这里有两点需要注意。

1.使用static关键字修改链接属性，`只对具有文件作用域的标识符生效`（对于拥有其他作用域的标识符是另一种功能）

2.`链接属性只能修改一次`，也就是说一旦将标识符链接属性变为internal，就无法变回iexternal了。